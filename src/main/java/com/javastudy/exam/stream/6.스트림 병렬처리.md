## 병렬 처리
### 병렬 처리(Parallel Operation)
- 멀티 코어 CPU환경에서 하나의 작업을 분할해서 각각의 코어가 병렬적으로 처리
  - 병렬 처리의 목적: 작업 처리 시간을 줄입
  - 자바8부터 병렬 스트림을 제공하므로 컬렉션(배열)의 전체 요소 처리 시간을 줄여줌
- 동시성(Concurrency)과 병렬성(Parallelism)
  - 동시성 : 멀티 스레드 환경에서 스레드가 번갈아 가며 실행하는 성질( 싱글 코어 CPU)
  - 병렬성 : 멀티 스레드 환경에서 코어들이 스레드를 병렬적으로 실행하는 성질(멀티 코어 CPU)
  - ![Concurrency1.png](picture%2FConcurrency1.png)
- 병렬성(Parallelism)구분
  - 데이터 병렬성
    - 데이터 병렬성은 한 작업 내에 있는 전체 데이터를 쪼개어 서브 데이터들로 만들고, 이 서브 데이터들을 병렬 처리해서 작업을 빨리 끝내는 것을 말한다.
 - 작업 병렬성
   - 작업 병렬성은 서로 다른 작업을 병렬 처리 하는것을 말한다.
   - 작업 병렬성의 대표적인 예는 웹서버(Web Server)이다.
   - 웹서버는 각각의 브라우저에서 요청한 내용(다른 작업)을 개별 스레드에서 병렬로 처리한다.
- 병렬 스트림은 데이터 병렬성을 구현한 것이다.
  - 멀티 코어의 수만큼 대용량 요소를 서브 요소들로 나누고, 각각의 서브 요소들을 분리된 스레드에서 병렬 처리시킨다.
  - 예를 들어 쿼드 코어(Quad Core)CPU일 경우 4개의 서브 요소들로 나누고, 4개의 스레드가 각각의 서브 요소들을 병렬 처리한다.
  - 병렬 스트림은 포크조인 프레임워크를 이용한다.


### 포크조인(ForkJoin) 프레임워크
- 포크조인 프레임워크 동작 방식
  - 포크(Fork) 단계 (분할해서 병렬처리)
    - 데이터를 서브 데이터로 반복적으로 분리한다.
    - 서브 데이터를 멀티 코어에서 병렬로 처리한다.
  - 조인 단계 (병렬처리 결과 결합해서 최종 결과 만듬)
    - 서브 결과를 결합해서 최종 결과를 만들어 낸다.
  - 실제로 병렬 처리 스트림은 포크단계에서 n등분을 하며 정해진 n은 아니다. 내부적으로 서브 요소로 나누는 알고리즘이 있기 때문에 개발자는 신경쓸 필요가 없다.
  - ![forkjoin1.png](picture%2Fforkjoin1.png)
  - 정리하자면, 병렬처리 시작시 fork로 분리되어 각각 처리 후, 이후 join으로 결과를 취합하여 최종결과로 반환
- 포크조인 풀(ForkJoin Pool)
  - 각각의 코어에서 서브 요소를 처리하는 것은 개별 스레드가 해야하므로 스레드 관리가 필요
  - 포크조인 프레임워크는 ExecutorService의 구현 객체인 ForkJoinPool을 사용
- 병렬 스트림 생성
  - Java.util.Collection  =>   parallelStream() => Stream 으로 반환하나 병렬처리 되는 Stream
  - java.util.Stream   =>  parallel() => Stream으로 반환 (순차 처리 스트림을 병렬 스트림으로 변환해서 Stream으로 리턴함.)
  - java.util.IntStream   =>  parallel() => IntStream으로 반환 (순차 처리 스트림을 병렬 스트림으로 변환해서 Stream으로 리턴함.)
  - java.util.LongStream   =>  parallel() => LongStream으로 반환 (순차 처리 스트림을 병렬 스트림으로 변환해서 Stream으로 리턴함.)
  - java.util.DoubleStream   =>  parallel() => DoubleStream으로 반환 (순차 처리 스트림을 병렬 스트림으로 변환해서 Stream으로 리턴함.)
### 병렬 처리 성능
- 병렬 처리는 항상 빠르다?
  - 스트림 병렬 처리가 스트림 순차 처리보다 항상 실행 성능이 좋다고 판단해서는 안된다.
- 병렬 처리에 영향을 미치는 3가지 요인
  - 요소의 수와 요소당 처리 시간
    - 컬렉션에 요소의 수가 적고 요소당 처리 시간이 짧으면 순차 처리가 오히려 병렬 처리보다 빠를 수 있다.
    - 병렬 처리는 스레드풀 생성, 스레드생성이라는 추가적인 비용을 발생시키기 때문
  - 스트림 소스의 종류 
    - ( ArrayList는 배열 단위라서 쉽게 요소 분리가능하여 병렬 처리 시간이 절약된다, )
    - 반면에 LinkedList는 랜덤 액세스를 지원하지 않아 링크를 따라가야 하므로 분리가 쉽지 않아 ArrayList, 배열보다 병렬처리가 늦다.
  - 코어(cpu core)수